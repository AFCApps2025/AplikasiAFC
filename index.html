<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    
    <!-- PWA Meta Tags for Fullscreen -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="AFC System">
    <meta name="theme-color" content="#16a34a">
    <meta name="msapplication-TileColor" content="#16a34a">
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- Android Fullscreen -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-status-bar-style" content="black-translucent">
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="format-detection" content="telephone=no">
    
    <title>AFC SYSTEM</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/AplikasiAFC/manifest.json">
    
    <!-- Favicons and Icons -->
    <link rel="icon" type="image/png" href="https://i.pinimg.com/736x/ad/a1/d4/ada1d418a14ad7df8df746e0657145a7.jpg" />
    <link rel="apple-touch-icon" href="/AplikasiAFC/192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/AplikasiAFC/152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/AplikasiAFC/192.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/AplikasiAFC/192.png">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="AFC Service Buddy - Air Conditioning Service Management System. Sistem manajemen service AC profesional untuk Aqsha Fresh & Cool." />
    <meta name="author" content="Aqsha Fresh & Cool" />
    <meta name="keywords" content="AFC, Service AC, Aqsha Fresh Cool, Manajemen Service, Booking AC, Teknisi AC" />

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="AFC Service Buddy" />
    <meta property="og:description" content="AFC Service Buddy - Air Conditioning Service Management System" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://i.pinimg.com/736x/ad/a1/d4/ada1d418a14ad7df8df746e0657145a7.jpg" />
    <meta property="og:url" content="https://aqma2025.github.io/" />

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:image" content="https://i.pinimg.com/736x/ad/a1/d4/ada1d418a14ad7df8df746e0657145a7.jpg" />
    
    <style>
      /* Prevent white screen during loading */
      #root {
        min-height: 100vh;
        background: linear-gradient(135deg, #f0fdf4 0%, #ffffff 50%, #fff7ed 100%);
      }
      
      /* Loading spinner */
      .loading-spinner {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 40px;
        height: 40px;
        border: 4px solid #e5e7eb;
        border-top: 4px solid #16a34a;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        z-index: 9999;
      }
      
      @keyframes spin {
        0% { transform: translate(-50%, -50%) rotate(0deg); }
        100% { transform: translate(-50%, -50%) rotate(360deg); }
      }
      
      /* Hide spinner when app loads */
      .app-loaded .loading-spinner {
        display: none;
      }

      /* Fullscreen mode - hide browser UI */
      @media (display-mode: fullscreen) {
        body {
          overflow: hidden;
        }
      }

      /* Mobile scroll fix */
      @media (max-width: 768px) {
        html, body {
          height: 100%;
          overflow: auto;
          -webkit-overflow-scrolling: touch;
        }
        
        #root {
          min-height: 100vh;
          overflow-y: auto;
        }
      }

    </style>
  </head>
  <body>
    <div id="root">
      <div class="loading-spinner"></div>
    </div>

    <script>
      // GitHub Pages SPA routing fix
      (function() {
        var redirect = sessionStorage.redirect;
        delete sessionStorage.redirect;
        if (redirect && redirect !== location.href) {
          history.replaceState(null, null, redirect);
        }
      })();
    </script>
    
    <script type="module" src="/src/main.tsx"></script>
    
    <script>
      // Service Worker Registration with Update Notification
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/AplikasiAFC/sw.js')
            .then((registration) => {
              console.log('âœ… Service Worker registered:', registration.scope);
              
              // Check for updates every 60 seconds
              setInterval(() => {
                registration.update();
              }, 60000);
              
              // Check for updates
              registration.addEventListener('updatefound', () => {
                const newWorker = registration.installing;
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    console.log('ðŸ”„ New version available!');
                    
                    // Show update notification
                    const updateBanner = document.createElement('div');
                    updateBanner.style.cssText = 'position:fixed;top:0;left:0;right:0;background:#16a34a;color:white;padding:16px;text-align:center;z-index:9999;box-shadow:0 4px 6px rgba(0,0,0,0.1);';
                    updateBanner.innerHTML = `
                      <div style="max-width:600px;margin:0 auto;">
                        <p style="margin:0 0 12px 0;font-weight:600;">ðŸ”„ Update Aplikasi Tersedia!</p>
                        <p style="margin:0 0 12px 0;font-size:14px;">Versi baru aplikasi sudah tersedia. Klik tombol di bawah untuk update.</p>
                        <button onclick="window.location.reload()" style="background:white;color:#16a34a;border:none;padding:10px 24px;border-radius:6px;font-weight:600;cursor:pointer;margin-right:8px;">Update Sekarang</button>
                        <button onclick="this.parentElement.parentElement.remove()" style="background:transparent;color:white;border:2px solid white;padding:10px 24px;border-radius:6px;font-weight:600;cursor:pointer;">Nanti</button>
                      </div>
                    `;
                    document.body.appendChild(updateBanner);
                    
                    // Auto reload after 30 seconds if user doesn't respond
                    setTimeout(() => {
                      if (document.body.contains(updateBanner)) {
                        window.location.reload();
                      }
                    }, 30000);
                  }
                });
              });
            })
            .catch((error) => {
              console.error('âŒ Service Worker registration failed:', error);
            });
        });
      }

      // Handle successful installation
      window.addEventListener('appinstalled', () => {
        console.log('âœ… PWA installed successfully!');
      });

      // Add app-loaded class when React app mounts
      window.addEventListener('load', function() {
        setTimeout(function() {
          document.body.classList.add('app-loaded');
        }, 1000);
      });
      
      // Error handling for unsupported browsers
      window.addEventListener('error', function(e) {
        console.error('Global error:', e.error);
        if (e.error && e.error.message && e.error.message.includes('modules')) {
          document.getElementById('root').innerHTML = 
            '<div style="padding: 20px; text-align: center; font-family: Arial, sans-serif;">' +
            '<h2>Browser Tidak Didukung</h2>' +
            '<p>Silakan gunakan browser yang lebih baru seperti Chrome, Firefox, atau Safari.</p>' +
            '</div>';
        }
      });

      // Check if running as PWA and request fullscreen
      window.addEventListener('load', () => {
        if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true) {
          console.log('ðŸš€ Running as PWA!');
          document.body.classList.add('pwa-mode');
          
          // Request fullscreen on mobile
          if (/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
            const elem = document.documentElement;
            if (elem.requestFullscreen) {
              elem.requestFullscreen().catch(err => console.log('Fullscreen request failed:', err));
            } else if (elem.webkitRequestFullscreen) {
              elem.webkitRequestFullscreen();
            } else if (elem.mozRequestFullScreen) {
              elem.mozRequestFullScreen();
            } else if (elem.msRequestFullscreen) {
              elem.msRequestFullscreen();
            }
          }
        }
      });

      // Auto-hide address bar on scroll
      window.addEventListener('load', () => {
        setTimeout(() => {
          window.scrollTo(0, 1);
        }, 100);
      });
    </script>
  </body>
</html>
